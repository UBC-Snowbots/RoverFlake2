# CMake file for roverflake unit tests
cmake_minimum_required(VERSION 3.20)

set(CMAKE_CXX_STANDARD 17) # cpp 2017 standard
set(CMAKE_CXX_STANDARD_REQUIRED True)

add_subdirectory(${CMAKE_CURRENT_LIST_DIR}/src/external_pkgs/Catch2 ${CMAKE_CURRENT_BINARY_DIR}/external_pkgs/Catch2) # Include Catch2 for unit tests

set(BUILD_DIR ${CMAKE_CURRENT_LIST_DIR}/build)
set(SRC_DIR ${CMAKE_CURRENT_LIST_DIR}/src)
set(SAMPLE_PKG_DIR ${SRC_DIR}/rover_samples/rv_sample_package/)
set(ROVER_UTILS_DIR ${SRC_DIR}/rover_utils/)

# Code under test sources + directories
include_directories(
    ${SAMPLE_PKG_DIR}/include
    ${ROVER_UTILS_DIR}/include

    # add more directories with needed .h headers
    )

set(ROVERFLAKE_SOURCES  
    ${SAMPLE_PKG_DIR}/src/unit_test_example_class.cpp # just an example
    # Add roverflake files here (code under test)

    # Autogenerated files:
    # ${BUILD_DIR}/autogen/*.cpp
    # ${BUILD_DIR}/autogen/*.c
)

set(TEST_SOURCES
    ${SRC_DIR}/rover_samples/rv_sample_package/test/unit_test_example.cpp
    # add more unit test files 
    )

add_executable(unit_tests
    ${TEST_SOURCES}
    ${ROVERFLAKE_SOURCES}
    )

target_link_libraries(unit_tests PRIVATE
    Catch2::Catch2WithMain)

target_compile_options(unit_tests PRIVATE 
    -Wall
    -Wextra
    # -Werror # Uncomment to be verry strict
)

include(CTest)
include(Catch)
catch_discover_tests(unit_tests)